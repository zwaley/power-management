!-- ... existing code ... -->
<div id="port-topology-container" class="topology-container">
    <!-- 控制面板：选择显示模式 -->
    <div class="control-panel">
        <label>
            <input type="radio" name="port-mode" value="all" checked> 显示所有端口
        </label>
        <label>
            <input type="radio" name="port-mode" value="used"> 只显示在用端口
        </label>
    </div>

    <!-- 拓扑图容器 -->
    <div id="topology-graph"></div>
</div>

<script>

// 初始化拓扑图
function initPortTopology(selectedDeviceId) {
    const mode = document.querySelector('input[name="port-mode"]:checked').value;
    const data = fetchPortTopologyData(selectedDeviceId, mode);

    // 渲染拓扑图
    renderTopology(data);
}

// 获取端口拓扑数据
function fetchPortTopologyData(deviceId, mode) {
    // 调用后端API获取设备及其端口连接关系
    return fetch(`/api/port-topology/${deviceId}?mode=${mode}`)
        .then(res => res.json())
        .catch(err => {
            console.error("Failed to fetch port topology data:", err);
            return { nodes: [], edges: [] };
        });
}

// 渲染拓扑图
function renderTopology(data) {
    const container = document.getElementById('topology-graph');
    const svg = d3.select(container).selectAll("svg").data([data]).enter().append("svg")
        .attr("width", "100%")
        .attr("height", "800");

    // 创建中心节点（选中设备）
    const centerNode = svg.append("g")
        .attr("class", "center-node")
        .attr("transform", "translate(500, 400)");

    centerNode.append("circle")
        .attr("r", 20)
        .style("fill", "#ff6b6b");

    centerNode.append("text")
        .attr("x", 0)
        .attr("y", 5)
        .attr("text-anchor", "middle")
        .text("111") // 示例：机房名称+设备名称
        .style("font-size", "14px");

    // 分割左右侧端口：左侧为上游（source），右侧为下游（target）
    const leftPorts = data.nodes.filter(n => n.type === 'left-port'); // 上游端口
    const rightPorts = data.nodes.filter(n => n.type === 'right-port'); // 下游端口

    // 左侧端口排列（上游）
    leftPorts.forEach((node, i) => {
        const x = 200;
        const y = 200 + i * 40;

        svg.append("g")
            .attr("class", "port-node")
            .attr("transform", `translate(${x}, ${y})`)
            .on("mouseover", () => showTooltip(node))
            .on("click", () => showDetails(node));

        svg.append("rect")
            .attr("x", -40)
            .attr("y", -15)
            .attr("width", 80)
            .attr("height", 30)
            .style("fill", "#4ecdc4")
            .style("stroke", "#3a7ca5");

        svg.append("text")
            .attr("x", 0)
            .attr("y", 5)
            .attr("text-anchor", "middle")
            .text(node.name)
            .style("font-size", "12px");
    });

    // 右侧端口排列（下游）
    rightPorts.forEach((node, i) => {
        const x = 800;
        const y = 200 + i * 40;

        svg.append("g")
            .attr("class", "port-node")
            .attr("transform", `translate(${x}, ${y})`)
            .on("mouseover", () => showTooltip(node))
            .on("click", () => showDetails(node));

        svg.append("rect")
            .attr("x", -40)
            .attr("y", -15)
            .attr("width", 80)
            .attr("height", 30)
            .style("fill", "#4ecdc4")
            .style("stroke", "#3a7ca5");

        svg.append("text")
            .attr("x", 0)
            .attr("y", 5)
            .attr("text-anchor", "middle")
            .text(node.name)
            .style("font-size", "12px");
    });

    // 绘制连接线
    data.edges.forEach(edge => {
        const source = edge.source;
        const target = edge.target;
        const line = svg.append("path")
            .datum(edge)
            .attr("d", d3.line()
                .x(d => d.x)
                .y(d => d.y)
            )
            .style("stroke", edge.type === "ac" ? "#f9c80e" : edge.type === "dc" ? "#e74c3c" : "#ccc")
            .style("stroke-width", 2)
            .style("stroke-dasharray", edge.type === "idle" ? "5,5" : "none")
            .attr("marker-end", "url(#arrowhead)");

        // 添加鼠标悬停提示
        line.on("mouseover", () => {
            tooltip.html(`<strong>电缆型号:</strong> ${edge.cableModel}`).style("visibility", "visible");
        })
        .on("mouseout", () => {
            tooltip.style("visibility", "hidden");
        });
    });

    // 添加箭头标记
    svg.append("defs").append("marker")
        .attr("id", "arrowhead")
        .attr("viewBox", "0 -5 10 10")
        .attr("refX", 5)
        .attr("refY", 0)
        .attr("markerWidth", 10)
        .attr("markerHeight", 10)
        .attr("orient", "auto")
        .append("path")
        .attr("d", "M0,-5L10,0L0,5")
        .style("fill", "#ff6b6b");
}
</script>

<!-- ... existing code ... -->