端口拓扑接口契约 v0.1 Draft

目标
- 为前端“端口拓扑”视图提供统一、稳定的接口输出，避免字段命名不一致导致的渲染冲突。
- 支持按设备生成端口级拓扑，并按需扩展到对端设备与跨设备连接。

接口一：查询设备（用于设备选择控件）
- `GET /api/devices/search?query=<text>&limit=<n>`
  - 入参：
    - `query`：模糊匹配设备名称/拼音/别名
    - `limit`：返回条数上限（默认 20）
  - 出参（示例）：
```
{
  "success": true,
  "items": [
    { "asset_id": "ASSET_13", "name": "新大楼一楼综合机房_1#直流系统直配屏E15", "station": "新大楼一楼" },
    { "asset_id": "ASSET_22", "name": "新大楼一楼_配电屏E16", "station": "新大楼一楼" }
  ]
}
```

接口二：生成端口拓扑（核心）
- `GET /api/port-topology?device_id=<asset_id>&expand=<bool>&filter_type=<AC|DC|Signal>&limit_edges=<n>`
  - 入参：
    - `device_id`（必填）：设备唯一业务ID（`asset_id`）
    - `expand`（可选，默认 `false`）：是否自动展开对端设备节点
    - `filter_type`（可选）：过滤连接类型（AC/DC/Signal）
    - `limit_edges`（可选）：限制最大渲染的边数量，保障性能
  - 出参（结构）：
    - `success`：布尔
    - `meta`：对象，包含 `device_id`、`device_name` 等上下文
    - `nodes`：数组，设备节点与端口节点混合；字段见“节点字段定义”
    - `edges`：数组，连接边；字段见“边字段定义”
  - 出参（示例）：
```
{
  "success": true,
  "meta": { "device_id": "ASSET_13", "device_name": "新大楼一楼综合机房_1#直流系统直配屏E15" },
  "nodes": [
    { "id": "device:ASSET_13", "type": "device", "label": "新大楼…E15",
      "name": "新大楼一楼综合机房_1#直流系统直配屏E15",
      "model": "配电屏E15", "vendor": "XX厂家", "power_rating": "60kVA",
      "station": "新大楼一楼", "commission_date": "2023-06-01", "lifecycle_status": "在役" },
    { "id": "port:ASSET_13:F1", "type": "port", "label": "F1", "asset_id": "ASSET_13",
      "port_code": "F1", "port_name": "馈路1", "status": "在用" },
    { "id": "port:ASSET_13:F2", "type": "port", "label": "F2", "asset_id": "ASSET_13",
      "port_code": "F2", "status": "空闲" }
  ],
  "edges": [
    { "id": "conn:ASSET_13:F1->ASSET_22:P18", "from": "port:ASSET_13:F1", "to": "port:ASSET_22:P18",
      "connection_type": "DC", "upstream_downstream": "下游",
      "cable_model": "VV-2x35mm²", "rated_current": 80, "installation_date": "2022-08-10" }
  ]
}
```

节点字段定义
- 通用：`id`、`type`（`device` | `port`）、`label`
- 设备节点（`type=device`）：
  - 必需：`id=device:<asset_id>`、`name`
  - 可选：`model`、`vendor`、`power_rating`、`station`、`commission_date`、`lifecycle_status`
- 端口节点（`type=port`）：
  - 必需：`id=port:<asset_id>:<port_code>`、`asset_id`、`port_code`
  - 可选：`port_name`、`status`

边字段定义
- 必需：`id`、`from`、`to`
- 可选：`connection_type`、`upstream_downstream`、`cable_model`、`rated_current`、`installation_date`

错误与状态码（建议）
- `200`：成功返回；`success=true`
- `400`：参数错误（缺少 `device_id` 或格式非法）
- `404`：设备不存在或无端口数据
- `422`：导入的数据未通过校验（参考《导入校验与映射报告模板》）
- `500`：服务端异常

兼容与演进
- 若内部数据模型使用英文或历史列名，统一在接口层转换到《字段字典与别名映射》的规范字段。
- 新增字段原则：不影响现有渲染的必需字段；新增字段一律为可选。

版本与维护
- 当前版本：v0.1（Draft）
- 维护方式：接口契约变更需在文档中追加“变更历史”，并在前端渲染层进行小版本适配。